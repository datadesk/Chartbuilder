<!DOCTYPE html>
<html lang="en" >
<head>
    <!-- METADATA -->
    <title>Los Angeles Times</title>

    <meta charset="utf-8" />
    <meta name="description" content="" />
    <meta name="keywords" content="data desk, los angeles times, latimes, l.a. times" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="//cookbook.latimes.com/img/favicon.ico">
    <meta name="google-site-verification" content="a9pAUAoFTyj7Nut3H5OiQ-fUyyqdwdVT7VcFGICrpTo" />

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="//cookbook.latimes.com/bootstrap/2.3.2/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="//cookbook.latimes.com/css/ngux-tophat-0.5.4.min.css" />
    <link rel="stylesheet" type="text/css" href="//cookbook.latimes.com/bootstrap/2.3.2/css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" type="text/css" href="//cookbook.latimes.com/css/ngux-tophat-responsive-0.5.4.min.css" />

    <!-- JAVASCRIPT -->
    <!--[if lt IE 9]>
        <script type="text/javascript" src="//cookbook.latimes.com/js/html5shiv.js"></script>
    <![endif]-->

    <script type="text/javascript" src="//cookbook.latimes.com/js/jquery-1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="//cookbook.latimes.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script src="//cookbook.latimes.com/js/underscore-1.8.3-min.js" type="text/javascript"></script>
    <!--[if lte IE 7]><script type="text/javascript" src="//cookbook.latimes.com/js/icons-ie7.js"></script><![endif]-->

    <style>
        @font-face {
            font-family: 'Benton Gothic Bold';
        src: url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-bold.eot');
        src: url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-bold.eot?#iefix') format('embedded-opentype'),
             url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-bold.woff') format('woff'),
             url('https://s3.amazonaws.com/latimes-datadesk-template/fonts/0.5.0/benton-gothic-bold.ttf') format('truetype');
        font-weight:normal;
        font-style:normal;
        }
        body, p {font-family: 'Benton Gothic Regular';}
        strong {font-family: 'Benton Gothic Bold';}
        .btn-upload {display:block; margin:20px 0;}
        .svg-slug-input,
        .svg-text-input {width:100%;}
        .alert-danger {background-color:transparent; border:none; padding:0;}
    </style>
</head>
<body data-ad-path="4011/trb.latimes/news/datadesk" data-ad-ptype="s" data-ad-iframe-url="/static/ngux-tophat-ad-iframe.html" >
    <!-- NAV -->

    <nav title="Navigation">
        <div id="tophat-container">
            <div id="tophat">

                <span id="tophat-dropdown">
                    <hr />
                    <hr />
                    <hr />
                </span>

                <a id="tophat-logo" href="//www.latimes.com/"></a>
                <div class="tophat-links">
                    <ul>
                        <li>
                            <a href="//www.latimes.com/local">Local</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/california">California</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/sports">Sports</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/entertainment">Entertainment</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/nation">Nation</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/world">World</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/business">Business</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/opinion">Opinion</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/style">Lifestyle</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/travel">Travel</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>


    <!-- CONTENT GOES HERE -->
    <div class="container" id="container">

        <div class="row">
            <div class="span8 offset2">
                <header class="center">
                    <h1>SVG von Blurbinator</h1>
                    <p>Use this page to upload SVGs into P2P blurb items, instead of uploading graphics as images.</p>
                </header>
                <form action="" name="svg-upload" id="svg-upload" class="svg-upload">
                    <h2>SVG slug</h2>
                    <input type="text" class="svg-slug-input" id="svg-slug" name="svg-slug" value="" required>

                    <div class="alert alert-danger" id="no-slug-warning">
                        Your graphic needs a slug!
                    </div>
                    <p class="slug-holder hidden" id="slug-holder">The P2P slug will be <strong id="slug-output"></strong></p>

                    <h2>Paste SVG from Illustrator</h2>
                    <textarea name="svg-text" id="svg-text" class="svg-text-input" cols="50" rows="10"></textarea>



                    <div class="preview-holder hidden" id="preview-holder">
                        <h2>Preview:</h2>
                        <div id="svg-preview"></div>
                    </div>

                    <div class="upload-btn-holder hidden" id="upload-btn-holder">
                        <h2>Upload your graphic to P2P</h2>
                        <button class="btn btn-large btn-upload" id="submit-btn">Upload</button>
                    </div>
                </form>
            </div>
        </div>


    </div>

    <footer title="Footer">
        <div id="footer-container">
            <div id="footer">
                <a id="footer-logo" href="//www.latimes.com/"></a>
                <div id="tos">
                    <a href="//www.tribpub.com/central-terms-of-service/">Terms of Service</a> |
                    <a href="//www.tribpub.com/privacy-policy-and-your-privacy-rights/">Privacy Policy</a> |
                    <a href="//www.latimes.com/lat-about-our-ads,0,3875412.htmlstory">About Our Ads</a> |
                    <a href="//www.latimes.com/services/site/la-reprint-request-splash,0,6731163.htmlstory">&copy; <script type="text/javascript">document.write(new Date().getFullYear())</script></a> |
                    <a href="//www.latimes.com/about/">About This Site</a>
                </div>
            </div>
        </div>
    </footer>


    <script>
        var submitBtn = $('#submit-btn');
        var preview = document.getElementById('svg-preview');
        var previewHolder = document.getElementById('preview-holder');
        var svgInput = $('#svg-text');
        var svgSlugInput = $("#svg-slug");
        var slugOutputHolder = document.getElementById('slug-holder');
        var slugOutput = document.getElementById('slug-output');
        var uploadBtnHolder = document.getElementById('upload-btn-holder');
        var noSlugWarning = document.getElementById('no-slug-warning');
        var slug = "";

        submitBtn.on('click', function(e) {
            e.preventDefault();
            var w = preview.clientWidth,
                h = preview.clientHeight,
                uri = btoa(preview.innerHTML),
                ratio = ((h / w) * 100).toFixed(2).toString();

            function onSuccess() {
                var el = "<p>Your SVG has been successfully saved to P2P. You can view your chart at <a target='_blank' href='/chartbuilder/get-p2p-admin-url/?slug=" + slug + "'>" + slug + "</a></p>";
                uploadBtnHolder.insertAdjacentHTML('beforeend',el);
            }

            function onError() {
                var el = "<p class='alert alert-danger'>There was an error saving to P2P.</p>";
                uploadBtnHolder.insertAdjacentHTML('beforeend',el);
            }

            sendToP2P(slug, uri, ratio, onSuccess, onError);

        });

        function getDateString() {
            // Return date string as YYYY-MM-DD
            var d = new Date();
            var dd = d.getDate();
            var mm = d.getMonth()+1; //January is 0!
            var yyyy = d.getFullYear();

            if(dd<10){
                dd='0'+dd
            }
            if(mm<10){
                mm='0'+mm
            }
            var dateString = "-" + yyyy + "-" + mm + "-" + dd;
            return dateString;
        }

        function slugify(v){
            var slug = "la-g-" + v.toLowerCase() + this.getDateString();
            // Switch spaces to slugs
            slug = slug.replace(/\s/g, "-");
            // Trim special characters
            slug = slug.replace(/[^\w-]+/g, "");
            return slug;
        }

        function sendToP2P(slug, uri, ratio, cb, err) {
            var params = "slug=" + slug + "&ratio=" + ratio + "&source=blurbinator&data=" +  encodeURIComponent(uri);
            var postrequest = new XMLHttpRequest();
            postrequest.open("POST", "/send-to-p2p/", true);
            postrequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

            postrequest.onreadystatechange = function() {
                if (postrequest.readyState == 4 && postrequest.status == 200) {
                    // Probably should have something render on success
                    if (cb && typeof(cb) === "function") {
                        cb();
                    }
                } else if (postrequest.readyState == 4 && postrequest.status == 500) {
                    if (err && typeof(err) === "function") {
                        err();
                    }
                }
            }
            postrequest.send(params);
        }

        svgInput.on('input propertychange', function() {
            preview.innerHTML = this.value;
            validateInput()
        });

        svgSlugInput.on('input propertychange', function() {
            slug = slugify(document.getElementById('svg-slug').value)
            slugOutput.innerHTML = slug;
            validateSlug()
        });

        function validateSlug() {
            if (document.getElementById('svg-slug').value.trim() !== '') {
                noSlugWarning.classList.add('hidden');
                slugOutputHolder.classList.remove('hidden');

                // If SVG text field is also filled out
                if (document.getElementById('svg-text').value.trim() !== '') {
                    uploadBtnHolder.classList.remove('hidden');
                }
            } else {
                noSlugWarning.classList.remove('hidden');
                slugOutputHolder.classList.add('hidden');
                uploadBtnHolder.classList.add('hidden');
            }
        }

        function validateInput() {
            if (document.getElementById('svg-text').value.trim() !== '') {
                previewHolder.classList.remove('hidden');

                // If slug field is also filled out
                if (document.getElementById('svg-slug').value.trim() !== '') {
                    uploadBtnHolder.classList.remove('hidden');
                }
            } else {
                uploadBtnHolder.classList.add('hidden');
                previewHolder.classList.add('hidden');
            }
        }

    </script>

</body>
<!--Good with data?-->
<!--Tired of grinding on the same old apps?-->
<!--Want to use your skills in defense of truth, justice and the American way?-->
<!--Email datadesk@latimes.com and let us know you're out there.-->
</html>