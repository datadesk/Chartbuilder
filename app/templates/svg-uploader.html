<!DOCTYPE html>
<html lang="en" >
<head>
    <!-- METADATA -->
    <title>Los Angeles Times</title>

    <meta charset="utf-8" />
    <meta name="description" content="" />
    <meta name="keywords" content="data desk, los angeles times, latimes, l.a. times" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="//cookbook.latimes.com/img/favicon.ico">
    <meta name="google-site-verification" content="a9pAUAoFTyj7Nut3H5OiQ-fUyyqdwdVT7VcFGICrpTo" />

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="//cookbook.latimes.com/bootstrap/2.3.2/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="//cookbook.latimes.com/css/ngux-tophat-0.5.4.min.css" />
    <link rel="stylesheet" type="text/css" href="//cookbook.latimes.com/bootstrap/2.3.2/css/bootstrap-responsive.min.css" />
    <link rel="stylesheet" type="text/css" href="//cookbook.latimes.com/css/ngux-tophat-responsive-0.5.4.min.css" />

    <!-- JAVASCRIPT -->
    <!--[if lt IE 9]>
        <script type="text/javascript" src="//cookbook.latimes.com/js/html5shiv.js"></script>
    <![endif]-->

    <script type="text/javascript" src="//cookbook.latimes.com/js/jquery-1.8.1/jquery.min.js"></script>
    <script type="text/javascript" src="//cookbook.latimes.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script src="//cookbook.latimes.com/js/underscore-1.8.3-min.js" type="text/javascript"></script>
    <!--[if lte IE 7]><script type="text/javascript" src="//cookbook.latimes.com/js/icons-ie7.js"></script><![endif]-->

    <style>
        .btn-upload {display:block;}
        .svg-slug-input,
        .svg-text-input {width:100%;}
    </style>
</head>
<body data-ad-path="4011/trb.latimes/news/datadesk" data-ad-ptype="s" data-ad-iframe-url="/static/ngux-tophat-ad-iframe.html" >
    <!-- NAV -->

    <nav title="Navigation">
        <div id="tophat-container">
            <div id="tophat">

                <span id="tophat-dropdown">
                    <hr />
                    <hr />
                    <hr />
                </span>

                <a id="tophat-logo" href="//www.latimes.com/"></a>
                <div class="tophat-links">
                    <ul>
                        <li>
                            <a href="//www.latimes.com/local">Local</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/california">California</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/sports">Sports</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/entertainment">Entertainment</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/nation">Nation</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/world">World</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/business">Business</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/opinion">Opinion</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/style">Lifestyle</a>
                        </li>
                        <li>
                            <a href="//www.latimes.com/travel">Travel</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>


    <!-- CONTENT GOES HERE -->
    <div class="container" id="container">
        <header class="center">
            <h1>SVG Upload Blurbinator</h1>
        </header>

        <div class="row">
            <div class="span8 offset2">
                <form action="" name="svg-upload" id="svg-upload" class="svg-upload">
                    <h2>SVG slug</h2>
                    <input type="text" class="svg-slug-input" id="svg-slug" name="svg-slug" value="" required>
                    <p>The P2P slug will be <strong id="slug-output"></strong></p>
                    <h2>Paste SVG from Illustrator</h2>
                    <textarea name="svg-text" id="svg-text" class="svg-text-input" cols="50" rows="10"></textarea>
                    <button class="btn btn-upload" id="submit-btn">Submit</button>
                </form>

                <h2>Preview:</h2>
                <div id="svg-preview"></div>

            </div>
        </div>


    </div>

    <footer title="Footer">
        <div id="footer-container">
            <div id="footer">
                <a id="footer-logo" href="//www.latimes.com/"></a>
                <div id="tos">
                    <a href="//www.tribpub.com/central-terms-of-service/">Terms of Service</a> |
                    <a href="//www.tribpub.com/privacy-policy-and-your-privacy-rights/">Privacy Policy</a> |
                    <a href="//www.latimes.com/lat-about-our-ads,0,3875412.htmlstory">About Our Ads</a> |
                    <a href="//www.latimes.com/services/site/la-reprint-request-splash,0,6731163.htmlstory">&copy; <script type="text/javascript">document.write(new Date().getFullYear())</script></a> |
                    <a href="//www.latimes.com/about/">About This Site</a>
                </div>
            </div>
        </div>
    </footer>


    <script>
        var submitBtn = $('#submit-btn');
        var preview = document.getElementById('svg-preview');
        var svgInput = $('#svg-text');
        var svgSlugInput = $("#svg-slug");
        var slugOutput = document.getElementById('slug-output');
        var slug = "";

        submitBtn.on('click', function(e) {
            e.preventDefault();
            var w = preview.clientWidth,
                h = preview.clientHeight,
                uri = btoa(preview.innerHTML),
                ratio = ((h / w) * 100).toFixed(2).toString();

            sendToP2P(slug, uri, ratio);

        });

        function getDateString() {
            // Return date string as YYYY-MM-DD
            var d = new Date();
            var dd = d.getDate();
            var mm = d.getMonth()+1; //January is 0!
            var yyyy = d.getFullYear();

            if(dd<10){
                dd='0'+dd
            }
            if(mm<10){
                mm='0'+mm
            }
            var dateString = "-" + yyyy + "-" + mm + "-" + dd;
            return dateString;
        }

        function slugify(v){
            var slug = "la-g-" + v.toLowerCase() + this.getDateString();
            // Switch spaces to slugs
            slug = slug.replace(/\s/g, "-");
            // Trim special characters
            slug = slug.replace(/[^\w-]+/g, "");
            return slug;
        }

        function sendToP2P(slug, uri, ratio, cb) {
            var params = "slug=" + slug + "&ratio=" + ratio + "&data=" +  encodeURIComponent(uri);
            var postrequest = new XMLHttpRequest();
            postrequest.open("POST", "/send-to-p2p/", true);
            postrequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

            postrequest.onreadystatechange = function() {
                if (postrequest.readyState == 4 && postrequest.status == 200) {
                    // Probably should have something render on success
                    if (cb && typeof(cb) === "function") {
                        cb();
                    }
                }
            }
            postrequest.send(params);
        }

        svgInput.on('input propertychange', function() {
            preview.innerHTML = this.value;
        });

        svgSlugInput.on('input propertychange', function() {
            slug = slugify(document.getElementById('svg-slug').value)
            slugOutput.innerHTML = slug;
        });

    </script>

</body>
<!--Good with data?-->
<!--Tired of grinding on the same old apps?-->
<!--Want to use your skills in defense of truth, justice and the American way?-->
<!--Email datadesk@latimes.com and let us know you're out there.-->
</html>